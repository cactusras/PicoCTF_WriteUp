# CTF 位元運算技巧

在 CTF（Capture The Flag）挑戰中，許多題目涉及 **位元運算（Bitwise Operations）**，尤其在加密解碼、逆向工程、PWN（溢位攻擊）等領域。這篇文章將整理常見的位元運算技巧，並提供相關的應用範例，讓你更快掌握 CTF 的解題策略。

---

## 1️⃣ **AND 運算（`&`）：取特定位**
### 📌 **用途：**
- **取數值的特定部分**（如 `& 0xFF` 取得低 8 位）
- **檢查某個 bit 是否為 `1`**

### 🔹 **範例**（取低 4 位）：
```python
x = 0b11011010  # 218 (十進制)
mask = 0b00001111  # 15 (十進制)
result = x & mask
print(bin(result))  # 0b1010 (取出低 4 位)
```
👉 **結果：取出 `11011010` 的低 4 位，變成 `1010`（0xA）。**

---

## 2️⃣ **OR 運算（`|`）：設定特定位**
### 📌 **用途：**
- **將某些 bit 設為 `1`**，而不改變其他 bit

### 🔹 **範例**（強制將最後兩位設為 `1`）：
```python
x = 0b10100000  # 160
mask = 0b00000101  # 設定最低兩位為 1
result = x | mask
print(bin(result))  # 0b10100101
```
👉 **結果：`10100000` 變成 `10100101`（0xA5）。**

---

## 3️⃣ **XOR 運算（`^`）：加密、翻轉 bit**
### 📌 **用途：**
- **簡單加密（XOR Cipher）**
- **檢測是否相同（`a ^ a = 0`）**
- **翻轉 bit 值**

### 🔹 **範例：XOR 加密/解密**
```python
key = 0x55  # 假設密鑰
char = ord('A')  # A = 65 (0x41)
encrypted = char ^ key  # XOR 加密
decrypted = encrypted ^ key  # XOR 兩次還原

print(encrypted, decrypted)  # 20 65
print(chr(decrypted))  # 'A'
```
👉 **結果：`A` 被 XOR 加密為 `0x14`，但 XOR 兩次後還原成 `A`！**

### 🔹 **範例：XOR 交換變數（無需額外變數）**
```python
a = 5
b = 7
a = a ^ b
b = a ^ b
a = a ^ b
print(a, b)  # 7, 5
```
👉 **結果：`a` 和 `b` 值交換，不需額外變數。**

---

## 4️⃣ **左移運算（`<<`）：乘法、組合 byte**
### 📌 **用途：**
- **將數值左移來做乘法**
- **組合多個 byte（如 `chr((A << 8) + B)`）**

### 🔹 **範例**
```python
x = 0b00000001  # 1
print(bin(x << 3))  # 0b1000 (相當於 1 * 2^3 = 8)
```
👉 **結果：左移 3 位，相當於 `1 * 8`，結果是 `8`（0b1000）。**

---

## 5️⃣ **右移運算（`>>`）：除法、拆解 byte**
### 📌 **用途：**
- **將數值右移來做除法**
- **從 16-bit 數值中拆出高位**

### 🔹 **範例**
```python
x = 0b10000000  # 128
print(bin(x >> 3))  # 0b1000 (相當於 128 / 2^3 = 16)
```
👉 **結果：右移 3 位，相當於 `128 ÷ 8`，結果是 `16`（0b1000）。**

---

## 6️⃣ **取反運算（`~`）：計算補數**
### 📌 **用途：**
- **取得補數（負數表示）**
- **在位元級別上翻轉數值**

### 🔹 **範例**
```python
x = 5
print(~x)  # -6 (Python 使用二補數表示負數)
```
👉 **結果：`~5 = -6`，因為 `~x = -x - 1`。**

---

## 7️⃣ **模運算（`%`）：環繞索引**
### 📌 **用途：**
- **環狀結構（如環形緩衝區）**
- **限制數值範圍**

### 🔹 **範例**
```python
index = 12
mod = 5
print(index % mod)  # 2
```
👉 **結果：當 `index = 12` 時，它在 5 的範圍內循環，結果是 `2`（因為 `12 ÷ 5 = 2...餘 2`）。**

---

## **🔎 CTF 實戰應用技巧**

### 📌 1. `chr()` & `ord()`
- `chr(65) → 'A'`
- `ord('A') → 65`
- `hex(ord('A')) → '0x41'`
- `bin(ord('A')) → '0b1000001'`

### 📌 2. 逆向 `int` → `bytes`
```python
x = 0x4142
print(x.to_bytes(2, 'big'))  # b'AB'
print(x.to_bytes(2, 'little'))  # b'BA'
```
👉 **用來還原 `chr((A << 8) + B)` 這類的加密方式！**

### 📌 3. 文字 XOR 解碼
```python
cipher = [0x12, 0x35, 0x47]
key = 0x55
flag = ''.join([chr(c ^ key) for c in cipher])
print(flag)
```
👉 **許多 CTF 題目會用 XOR 來隱藏 flag。**

---

